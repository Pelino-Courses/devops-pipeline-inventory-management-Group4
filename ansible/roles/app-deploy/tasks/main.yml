---
- name: Create application directory
  file:
    path: /opt/inventory-app
    state: directory
    owner: "{{ ansible_user }}"
    group: docker
    mode: '0755'

- name: Login to Azure Container Registry
  community.docker.docker_compose_v2:
    project_src: /opt/inventory-app
    state: present
    recreate: always
    remove_orphans: true

- name: Wait for backend to be ready
  uri:
    url: "http://localhost:5000/health"
    status_code: 200
  register: backend_result
  until: backend_result.status == 200
  retries: 30
  delay: 2

- name: Wait for frontend to be ready
  uri:
    url: "http://localhost:3000"
    status_code: 200
  register: frontend_result
  until: frontend_result.status == 200
  retries: 30
  delay: 2